"use strict";var p=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var h=Object.prototype.hasOwnProperty;var T=(o,n)=>{for(var t in n)p(o,t,{get:n[t],enumerable:!0})},E=(o,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of y(n))!h.call(o,s)&&s!==t&&p(o,s,{get:()=>n[s],enumerable:!(e=b(n,s))||e.enumerable});return o};var x=o=>E(p({},"__esModule",{value:!0}),o);var R={};T(R,{builderDevTools:()=>j});module.exports=x(R);var d=require("os"),u=require("../core/index.cjs"),w=require("../node/index.cjs"),f=require("../server/index.cjs");async function g(o,n){let t=await o.readFile(n);return typeof t=="string"?C(t):null}function C(o){let n={},t=o.replace(/\r\n?/gm,`
`),e;for(;(e=F.exec(t))!=null;){let s=e[1],r=e[2]||"";r=r.trim();let c=r[0];r=r.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),c==='"'&&(r=r.replace(/\\n/g,`
`),r=r.replace(/\\r/g,"\r")),n[s]=r}return n}var F=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function j(o={}){return{name:"vite-plugin-builder-dev-tools",async configureServer(t){let e=await(0,w.createDevToolsNodeSys)({getRootDir:()=>t.config.root}),s=await(0,u.createDevTools)(e),r=await(0,f.createDevToolsServer)({...s,getClientId:()=>"vite-builder-dev-tools",getLocalHostname:()=>e.hash((0,d.hostname)()),closeAppServer:async()=>{e.debug("close server"),await t?.close()},restartAppServer:async()=>{e.debug("restart server"),await t?.restart()},enableAppWatch:async c=>{if(c){e.debug("enable watch"),t?.watcher.add(t.config.root);let i=e.join(t.config.root,".git"),l=e.join(t.config.root,"node_modules");t?.watcher.unwatch([i,l])}else e.debug("disable watch"),t?.watcher.unwatch(t.config.root);return c},...e,...o});t.watcher.on("change",async c=>{if(c.includes(".env")){let i=await g(e,c);i&&Object.keys(i).forEach(a=>{process.env[a]=i[a]})}}),t.middlewares.use(async(c,i,l)=>{try{let a=i.end;i.end=function(...m){if((i.getHeader("Content-Type")||"").toString().includes("text/html")){let $=r.getClientInjectScript();i.write(`<script>${$}</script>`)}return a.apply(this,m)},l()}catch(a){l(a)}})}}}0&&(module.exports={builderDevTools});
