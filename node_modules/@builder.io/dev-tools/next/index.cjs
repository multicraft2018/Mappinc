module.exports = (opts = {}) => {
  return (nextConfig = {}) => {
    return Object.assign({}, nextConfig, {
      webpack(config, options) {
        if (opts.enabled !== false) {
          const { BuilderDevToolsPlugin } = require("../webpack/index.cjs");
          config.plugins.push(new BuilderDevToolsPlugin(opts));
        }

        if (typeof nextConfig.webpack === "function") {
          return nextConfig.webpack(config, options);
        }
        return config;
      },
    });
  };
};
